# ADR 0002: 상태 조회를 위한 Server-Sent Events(SSE) 도입

## 1. Context (도입 배경 및 문제 상황)
- 기존 아키텍처에서는 클라이언트가 3초 간격으로 상태를 묻는 Polling 방식을 사용하여 PDF 렌더링 완료 상태를 확인했습니다.
- 사용자가 많아질 경우, 대기 중인 모든 클라이언트가 지속적으로 HTTP GET 요청을 보내게 되어 API 서버에 불필요한 트래픽 오버헤드와 리소스 낭비가 발생하는 문제가 제기되었습니다.

## 2. Decision (결정 사항)
- 비동기 작업 큐 상태 통신 방식을 Polling에서 Server-Sent Events(SSE)로 변경합니다.
- 클라이언트는 `/job-events/:id` 엔드포인트를 통해 단방향 연결을 수립하고, 서버는 BullMQ 작업이 `completed` 또는 `failed` 상태에 도달할 때 해당 이벤트를 클라이언트에게 Push하고 연결을 종료합니다.
- 양방향 통신이 필요하지 않은 작업 상태 알림 목적이므로, 복잡한 설정이 요구되는 WebSocket 대신 HTTP 기반의 SSE를 선택했습니다.

## 3. Consequences (결과, 장단점 및 후속 조치)
- **장점**: 불필요한 HTTP 연결 수립 및 해제 과정이 생략되어 서버 부하가 감소하고 네트워크 자원 사용이 최적화됩니다. 완료 직후 클라이언트가 즉시 응답을 받을 수 있어 실시간성이 개선됩니다.
- **단점**: 연결이 오랫동안 유지되므로 로드밸런서나 프록시 서버(Nginx 등)의 타임아웃 설정을 조정해야 할 수 있습니다.
- **후속 조치**: 인프라 배포 시, Nginx나 Docker 환경의 `proxy_read_timeout` 등의 관련 네트워크 제한 시간을 검토하고 필요시 연장 조치를 수행해야 합니다.